# 非交易日数据获取问题及解决方案

## 问题描述

今天是周六（2026-02-08），属于非交易日。BaoStock API在非交易日不返回股票列表数据，导致：

```
[INFO] [BaoStock] 从BaoStock获取到 0 条记录
[WARNING] [BaoStock] BaoStock返回的股票列表为空
[ERROR] [DataDownloader] 获取股票列表失败
```

由于本地也没有缓存的股票列表文件（`data/stocks/stock_list.csv`），程序无法获取股票数据。

## 解决方案

### 方案1：切换到AkShare数据源（推荐，立即可用）

AkShare可以在非交易日获取股票列表。修改配置文件：

**编辑 `config/config.ini`，将第12行改为：**

```ini
source = akshare
```

然后重新运行程序，AkShare应该能够获取股票列表。

**注意**：使用AkShare前需要确保已安装：
```bash
pip install akshare
```

### 方案2：等待工作日（周一至周五）

在交易日（周一至周五的15:30之后），BaoStock会返回当日的股票列表数据。届时：

1. 首次运行会下载股票列表并保存到 `data/stocks/stock_list.csv`
2. 后续运行会使用缓存，除非缓存过期

### 方案3：手动下载股票列表（高级用户）

如果有其他途径获取了股票列表CSV文件，可以手动放置到：
```
data/stocks/stock_list.csv
```

文件格式要求：
- 必须包含 `code` 列（6位股票代码）
- 必须包含 `name` 列（股票名称）
- CSV格式，UTF-8编码

## 建议配置

为了避免此问题，建议：

1. **主要使用BaoStock**：更稳定可靠
2. **在工作日首次运行**：建立本地缓存
3. **保留缓存文件**：`data/stocks/stock_list.csv` 不要删除
4. **配置合理的更新周期**：`update_stock_list_days = 7`（每周更新一次即可）

## 数据源对比

| 特性 | BaoStock | AkShare |
|------|----------|---------|
| 稳定性 | 更稳定 | 偶尔不稳定 |
| 非交易日 | 无数据 | 有数据 |
| 历史数据 | 完整 | 完整 |
| 推荐程度 | 工作日推荐 | 非交易日可用 |

## 改进建议

程序已经做了以下改进：

1. **更详细的日志**：区分"API返回None"和"返回空数据"
2. **自动使用缓存**：如果API返回空，尝试读取本地缓存
3. **友好的错误消息**：提示用户可能是非交易日导致的问题

下次在工作日运行后，即使周末运行也能使用缓存数据。
